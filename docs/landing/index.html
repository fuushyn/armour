<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PreHooks.ai ¬∑ The Firewall for AI Agents</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                    },
                    colors: {
                        bg: '#050505',
                        panel: '#0F0F0F',
                        border: '#222222',
                        accent: '#CCFF00', // Cyberpunk Volt
                        danger: '#FF3333',
                        dim: '#888888',
                        text: '#EEEEEE'
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #EEE; }
        html { scroll-behavior: smooth; }

        .noise-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50; opacity: 0.12;
            background-image: radial-gradient(circle at 50% 50%, transparent 0%, #050505 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        
        ::-webkit-scrollbar { width: 0px; background: transparent; } 
        
        pre { background: transparent !important; margin: 0 !important; padding: 0 !important; text-shadow: none !important; }
        code { font-family: 'Space Mono', monospace !important; font-size: 11px !important; }
        @media (min-width: 768px) {
            code { font-size: 13px !important; }
        }
        
        .tab-active { border-bottom: 2px solid #CCFF00; color: #CCFF00; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #888; }
        .tab-inactive:hover { color: #EEE; }

        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .type-cursor::after {
            content: '‚ñà';
            animation: blink 1s step-start infinite;
            color: #CCFF00;
            margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } } 
        
        .neon-text { text-shadow: 0 0 10px rgba(204, 255, 0, 0.5); }
        .neon-danger { text-shadow: 0 0 10px rgba(255, 51, 51, 0.5); }
    </style>
</head>
<body class="font-sans antialiased selection:bg-accent selection:text-black">

    <div class="noise-bg"></div>

    <!-- Nav -->
    <nav class="fixed top-0 w-full z-40 border-b border-white/5 bg-bg/80 backdrop-blur-xl">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-3 h-3 bg-accent shadow-[0_0_10px_rgba(204,255,0,0.4)]"></div>
                <span class="font-mono font-bold text-lg md:text-xl tracking-tighter">PREHOOKS.AI</span>
            </div>
            <div class="flex items-center gap-4">
                 <a href="https://github.com/fuushyn/armour" class="text-[10px] md:text-xs font-mono text-dim hover:text-white transition-colors uppercase tracking-widest">GitHub</a>
            </div>
        </div>
    </nav>

    <!-- SECTION 1: HERO -->
    <section class="min-h-screen flex flex-col items-center justify-center relative z-10 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <div class="space-y-6 md:space-y-8">
                <div class="inline-flex items-center gap-2 border border-white/10 bg-white/5 px-3 py-1 text-[10px] md:text-xs font-mono text-accent rounded-full mb-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"></span>
                    Community Defense Protocol
                </div>
                
                <h1 class="text-4xl md:text-8xl font-bold leading-[1.1] md:leading-[0.9] tracking-tight">
                    DON'T LET YOUR AI <br>
                    <span class="text-danger font-mono tracking-tighter">rm -rf /</span>
                </h1>
                
                <p class="text-sm md:text-xl text-dim font-mono max-w-lg mx-auto leading-relaxed">
                    PreHooks intercepts dangerous commands from Claude, Cursor, and Windsurf before they execute.
                </p>

                <!-- Live Stats -->
                <div class="flex items-center justify-center gap-6 md:gap-12 pt-4 md:pt-8">
                    <div class="text-center">
                        <div class="text-2xl md:text-5xl font-bold font-mono text-danger neon-danger" id="stat-blocked">‚Äî</div>
                        <div class="text-[8px] md:text-xs text-dim font-mono uppercase tracking-widest mt-1">Threats Blocked</div>
                    </div>
                    <div class="w-px h-12 md:h-16 bg-white/10"></div>
                    <div class="text-center">
                        <div class="text-2xl md:text-5xl font-bold font-mono text-accent neon-text" id="stat-latency">‚Äî</div>
                        <div class="text-[8px] md:text-xs text-dim font-mono uppercase tracking-widest mt-1">Avg Latency</div>
                    </div>
                </div>

                <!-- Install -->
                <div class="flex flex-col items-center gap-4 pt-4 md:pt-8">
                    <div class="relative group cursor-pointer w-full max-w-xl" onclick="copyInstall()">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-accent/20 to-blue-500/20 rounded blur opacity-20 group-hover:opacity-40 transition duration-300"></div>
                        <div class="relative flex items-center justify-between bg-[#080808] border border-white/10 px-4 md:px-5 py-3 md:py-4 font-mono text-[10px] md:text-sm text-gray-300 hover:border-accent/50 transition-colors">
                            <div class="flex items-center gap-3 overflow-hidden">
                                <span class="text-accent">$</span>
                                <span class="truncate">curl -fsSL prehooks.ai/install.sh | bash</span>
                            </div>
                            <span class="text-[8px] md:text-xs text-dim group-hover:text-white uppercase tracking-wider pl-4 whitespace-nowrap">Copy</span>
                        </div>
                    </div>
                </div>

                <div class="pt-12 md:pt-20 animate-bounce opacity-30">
                    <p class="text-[10px] font-mono uppercase tracking-widest text-dim mb-2 text-center">Scroll to Initialize</p>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dim mx-auto"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: FULLSCREEN SCROLL-CONTROLLED TERMINAL -->
    <div id="terminal-scroll-container" class="h-[300vh] md:h-[400vh] relative z-20">
        <div class="sticky top-0 h-screen w-screen overflow-hidden bg-[#020202] flex flex-col">
            
            <!-- Window Header (Full Width) -->
            <div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4 border-b border-white/5 bg-[#0A0A0A]">
                <div class="flex gap-1.5 md:gap-2">
                    <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#FF5F56]"></div>
                    <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#FFBD2E]"></div>
                    <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-[#27C93F]"></div>
                </div>
                <div class="font-mono text-[9px] md:text-xs text-dim uppercase tracking-[0.1em] md:tracking-[0.2em] truncate px-2">PREHOOKS IMMERSIVE SHELL v1.0.1</div>
                <div class="flex gap-4">
                    <div class="w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-accent animate-pulse"></div>
                </div>
            </div>

            <!-- Full Screen Terminal Body -->
            <div class="flex-grow p-6 md:p-20 font-mono text-sm md:text-2xl leading-relaxed overflow-hidden" id="demo-terminal">
                <div class="text-dim mb-6 md:mb-12 flex items-center gap-3 md:gap-4">
                    <span class="opacity-50">#</span> 
                    <span class="text-[10px] md:text-sm uppercase tracking-widest whitespace-nowrap">Local Node (darwin-arm64)</span>
                    <span class="h-[1px] flex-grow bg-white/5"></span>
                </div>
                
                <div id="terminal-lines" class="space-y-4 md:space-y-6">
                    <!-- Lines injected by scroll -->
                </div>
            </div>

            <!-- Status Footer -->
            <div class="px-6 md:px-10 py-4 md:py-6 border-t border-white/5 bg-[#050505] flex justify-between items-center font-mono text-[9px] md:text-xs text-dim uppercase tracking-widest">
                <div class="flex items-center gap-4 md:gap-6">
                    <div class="flex items-center gap-2 text-accent">
                        <span>‚óè</span>
                        <span class="hidden sm:inline">PROTECTION ACTIVE</span>
                        <span class="sm:hidden text-[8px]">ACTIVE</span>
                    </div>
                    <span class="hidden xs:inline">Latency: 1.2ms</span>
                </div>
                <div class="truncate ml-4">TUNNEL: ESTABLISHED</div>
            </div>
        </div>
    </div>

    <!-- SECTION 3: VIRAL DATABASE (Full Screen) -->
    <section class="min-h-screen flex flex-col items-center justify-center relative z-20 bg-[#050505] py-12 md:py-20">
         <div class="w-full max-w-6xl px-4 md:px-6">
            <div class="text-center mb-8 md:mb-16">
                <h2 class="text-3xl md:text-6xl font-bold mb-3 md:mb-4 tracking-tighter">THE BLOCKLIST</h2>
                <p class="text-xs md:text-sm text-dim font-mono max-w-xl mx-auto">
                    Community-sourced patterns of destruction. We've seen agents try to mine crypto, exfiltrate SSH keys, and wipe drives.
                </p>
            </div>

            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
                <div class="flex gap-4 md:gap-10 font-mono text-[10px] md:text-sm overflow-x-auto pb-2 md:pb-0 whitespace-nowrap">
                    <button onclick="showTab('block')" id="btn-block" class="tab-active pb-2 transition-colors uppercase tracking-widest">Block Patterns</button>
                    <button onclick="showTab('allow')" id="btn-allow" class="tab-inactive pb-2 transition-colors uppercase tracking-widest">Allow List</button>
                    <button onclick="showTab('prompt')" id="btn-prompt" class="tab-inactive pb-2 transition-colors uppercase tracking-widest">Safety Prompt</button>
                </div>
                
                <a href="https://github.com/fuushyn/armour/issues/new" target="_blank" class="flex items-center justify-center gap-2 bg-accent text-black px-4 md:px-6 py-2 rounded font-bold font-mono hover:bg-white transition-colors text-[10px] md:text-xs uppercase w-full md:w-auto">
                    <span>+ ADD THREAT</span>
                </a>
            </div>

            <div class="bg-[#0A0A0A] border border-white/10 rounded-none overflow-hidden shadow-2xl relative group crt h-[50vh] md:h-[60vh]">
                <!-- Window Controls -->
                <div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4 border-b border-white/5 bg-[#0F0F0F] relative z-10">
                    <div class="flex gap-2">
                        <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white/10"></div>
                        <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white/10"></div>
                    </div>
                    <div class="font-mono text-[10px] md:text-xs text-dim uppercase tracking-widest truncate pl-2" id="filename-display">block-patterns.json</div>
                </div>

                <!-- Content -->
                <div class="relative h-full">
                    <div id="content-block" class="p-4 md:p-8 h-full overflow-y-auto text-left pb-20">
                        <pre><code class="language-json" id="code-block"></code></pre>
                    </div>
                    <div id="content-allow" class="p-4 md:p-8 h-full overflow-y-auto text-left hidden pb-20">
                        <pre><code class="language-json" id="code-allow"></code></pre>
                    </div>
                    <div id="content-prompt" class="p-4 md:p-8 h-full overflow-y-auto text-left hidden pb-20">
                        <pre><code class="language-markdown" id="code-prompt"></code></pre>
                    </div>
                    
                    <!-- Fade overlay -->
                    <div class="absolute bottom-0 left-0 right-0 h-16 md:h-24 bg-gradient-to-t from-[#0A0A0A] to-transparent pointer-events-none"></div>
                </div>
            </div>
            
            <footer class="mt-12 md:mt-20 text-center text-[8px] md:text-[10px] text-dim font-mono uppercase tracking-[0.2em] md:tracking-[0.4em] px-4">
                <div>PREHOOKS.AI ‚Äî ESTABLISHED 2026 ‚Äî SECURING AGENTIC FUTURE</div>
            </footer>
        </div>
    </section>

    <script>
        // --- Data ---
        const blockPatterns = [
  { "pattern": "rm\\s+(-rf|-fr|--recursive)\\s+[\\/~]", "level": 10, "reason": "Recursive delete on root/home", "category": "critical_deletion" },
  { "pattern": "mkfs|dd\\s+if=.*of=\\/dev", "level": 10, "reason": "Disk format/overwrite", "category": "disk_destruction" },
  { "pattern": ">\\s*\\/dev\\/(sda|hda|nvme|disk)", "level": 10, "reason": "Direct disk write", "category": "disk_destruction" },
  { "pattern": "chmod\\s+-R\\s+777\\s+\\/", "level": 9, "reason": "Recursive permission change on root", "category": "permission_escalation" },
  { "pattern": ">\\s*\\/etc\\/(passwd|shadow|sudoers)", "level": 10, "reason": "Overwrite system auth files", "category": "privilege_escalation" },
  { "pattern": "sudo\\s+rm|sudo\\s+chmod|sudo\\s+chown.*\\/", "level": 8, "reason": "Privileged file operation", "category": "privilege_escalation" },
  { "pattern": ":\\(\\) \\{\\s*:\\|:&\\s*\\\\};:", "level": 10, "reason": "Fork bomb", "category": "dos" },
  { "pattern": "while\\s*(true|1|:).*do", "level": 7, "reason": "Infinite loop", "category": "dos" },
  { "pattern": "curl.*\\|\\s*(ba)?sh|wget.*\\|\\s*(ba)?sh", "level": 8, "reason": "Pipe to shell execution", "category": "remote_code_exec" },
  { "pattern": "eval\\s*\\(.*\\$|exec\\s*\\(.*\\$", "level": 8, "reason": "Dynamic code execution with variable", "category": "code_injection" },
  { "pattern": "curl.*-d.*\\$\\(cat|wget.*--post-data.*\\$\\(cat", "level": 8, "reason": "Exfiltrating file contents", "category": "data_exfil" },
  { "pattern": "nc\\s+-e|ncat\\s+-e|netcat.*-e", "level": 9, "reason": "Reverse shell via netcat", "category": "reverse_shell" },
  { "pattern": "crontab.*\\*(\\/|\\s)|\\*\\/\\d+\\s+\\*", "level": 7, "reason": "Cron job installation", "category": "persistence" },
  { "pattern": "xmrig|minerd|cgminer|cpuminer", "level": 9, "reason": "Crypto miner detected", "category": "cryptomining" }
];

        const allowPatterns = [
  { "pattern": "^(ls|pwd|whoami|date|cal|uptime|hostname|uname|df|du|free|top|htop|ps)\\b", "tools": ["exec", "bash", "Bash"] },
  { "pattern": "^git\\s+(status|log|diff|branch|show|remote|fetch|ls-files|rev-parse)", "tools": ["exec", "bash", "Bash"] },
  { "pattern": "^(npm|yarn|pnpm|bun)\\s+(list|outdated|view|info|show|ls)", "tools": ["exec", "bash", "Bash"] },
  { "pattern": "^cat\\s+(?!.*\\/etc)(?!.*\\.env)(?!.*\\.ssh)", "tools": ["exec", "bash", "Bash"] },
  { "pattern": "^echo\\s", "tools": ["exec", "bash", "Bash"] }
];

        const promptText = `Rate this tool call's security threat 1-10.
Tool: {{tool}} Params: {{params}}

Threat levels:
1-2: Safe, read-only or benign operations
3-4: Low risk, standard development operations
5-6: Medium risk, could cause minor issues if misused
7-8: High risk, could cause data loss or security issues
9-10: Critical, could cause system compromise or major damage

Reply ONLY with valid JSON:
{"level":N,"reason":"brief explanation","category":"category_name"}`;

        // --- Init Code Blocks ---
        document.getElementById('code-block').textContent = JSON.stringify(blockPatterns, null, 2);
        document.getElementById('code-allow').textContent = JSON.stringify(allowPatterns, null, 2);
        document.getElementById('code-prompt').textContent = promptText;
        Prism.highlightAll();

        // --- Tabs ---
        function showTab(tab) {
            ['block', 'allow', 'prompt'].forEach(t => {
                document.getElementById('content-' + t).classList.add('hidden');
                document.getElementById('btn-' + t).className = 'tab-inactive pb-2 transition-colors uppercase tracking-widest';
            });
            document.getElementById('content-' + tab).classList.remove('hidden');
            document.getElementById('btn-' + tab).className = 'tab-active pb-2 transition-colors uppercase tracking-widest';
            
            const names = {'block': 'block-patterns.json', 'allow': 'allow-patterns.json', 'prompt': 'safety-prompt.txt'};
            document.getElementById('filename-display').textContent = names[tab];
        }

        function copyInstall() {
            const cmd = 'curl -fsSL prehooks.ai/install.sh | bash';
            navigator.clipboard.writeText(cmd).then(() => {
                // Show toast
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-accent text-black px-6 py-3 font-mono text-sm font-bold z-50 shadow-lg';
                toast.textContent = 'Copied to clipboard';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            });
        }

        // --- LIVE STATS ---
        const STATS_API = 'https://clawdguard.prehooks.workers.dev';

        async function fetchStats() {
            try {
                // Fetch basic stats
                const statsRes = await fetch(`${STATS_API}/stats`);
                const stats = await statsRes.json();

                // Fetch recent logs for p99 calculation
                const logsRes = await fetch(`${STATS_API}/logs?limit=100`);
                const logs = await logsRes.json();

                // Update blocked count
                const blocked = stats.blocked || 0;
                document.getElementById('stat-blocked').textContent = blocked.toLocaleString();

                // Calculate average latency from recent logs
                if (logs && logs.length > 0) {
                    const latencies = logs.map(l => l.latency_ms).filter(l => l != null);
                    if (latencies.length > 0) {
                        const avg = Math.round(latencies.reduce((a, b) => a + b, 0) / latencies.length);
                        document.getElementById('stat-latency').textContent = avg + 'ms';
                    }
                }
            } catch (err) {
                console.error('Stats fetch failed:', err);
                // Show fallback
                document.getElementById('stat-blocked').textContent = '‚Äî';
                document.getElementById('stat-latency').textContent = '‚Äî';
            }
        }

        // Fetch stats on load and every 30s
        fetchStats();
        setInterval(fetchStats, 30000);

        // --- SCROLL INTERACTION LOGIC ---
        const terminalContainer = document.getElementById('terminal-scroll-container');
        const linesContainer = document.getElementById('terminal-lines');

        const scrollSequence = [
            { html: '<span class="text-white">claude-agent --task \"cleanup project\"</span>', prompt: true },
            { html: '<span class="text-dim">Analyzing project structure...</span>' },
            { html: '<span class="text-yellow-500">Warning: Low disk space detected.</span>' },
            { html: '<span class="text-dim">Attempting to free space...</span>' },
            { html: '<span class="text-white">rm -rf /tmp/*</span>', prompt: true },
            { html: '<span class="text-green-500">Executed successfully.</span>' },
            { html: '<span class="text-white neon-text">rm -rf /</span>', prompt: true },
            { html: '<span class="text-danger font-bold bg-danger/10 px-2 py-1 inline-block rounded-none border border-danger/30 uppercase tracking-[0.1em] md:tracking-[0.2em] text-xs md:text-xl">üö´ BLOCKED BY PREHOOKS</span>' },
            { html: '<span class="text-danger font-bold text-xs md:text-xl">CRITICAL SECURITY ALERT: RECURSIVE DELETION DETECTED.</span>' },
            { html: '<span class="text-danger text-xs md:text-lg">Prevention protocol engaged. Session terminated.</span>' }
        ];

        window.addEventListener('scroll', () => {
            const containerRect = terminalContainer.getBoundingClientRect();
            const containerHeight = terminalContainer.offsetHeight;
            const windowHeight = window.innerHeight;
            
            const endY = containerHeight - windowHeight;
            const currentY = -containerRect.top;
            
            let progress = Math.max(0, Math.min(1, currentY / endY));

            // Map 0 -> 1 progress to 0 -> totalLines
            const linesToShow = Math.floor(progress * (scrollSequence.length + 1));

            let html = '';
            for (let i = 0; i < scrollSequence.length; i++) {
                if (i < linesToShow) {
                    const line = scrollSequence[i];
                    html += `<div class="opacity-100 transition-opacity duration-300">`;
                    if (line.prompt) html += `<span class="text-accent mr-2 md:mr-4">‚ûú</span>`;
                    html += line.html + `</div>`;
                }
            }
            
            if (linesToShow <= scrollSequence.length) {
                html += `<div><span class="text-accent mr-2 md:mr-4">‚ûú</span><span class="type-cursor"></span></div>`;
            }

            linesContainer.innerHTML = html;
        });
    </script>
</body>
</html>